<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shakti Junior College - Admission & Fee Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --accent-color: #f97316;
            --success-color: #22c55e;
            --danger-color: #ef4444;
            --light-bg: #f8fafc;
            --dark-text: #1e293b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .logo-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2em;
            font-weight: bold;
        }

        h1 {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tagline {
            color: #666;
            font-size: 1.1em;
        }

        .academic-year {
            display: inline-block;
            background: var(--accent-color);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
        }

        .sidebar {
            position: fixed;
            left: 20px;
            top: 20px;
            width: 250px;
            background: var(--primary-color);
            border-radius: 15px;
            padding: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .sidebar-header {
            color: white;
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h3 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .user-info {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .nav-menu {
            list-style: none;
            padding: 20px 0;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            color: rgba(255,255,255,0.8);
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left-color: var(--accent-color);
        }

        .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            border-left-color: var(--accent-color);
        }

        .main-content {
            margin-left: 290px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            color: #64748b;
            font-size: 0.95em;
        }

        .content-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-title {
            color: var(--primary-color);
            font-size: 1.8em;
            font-weight: 600;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-text);
            font-weight: 600;
            font-size: 0.95em;
        }

        .required::after {
            content: " *";
            color: var(--danger-color);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-outline {
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            padding-left: 45px;
        }

        .search-box::before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2em;
        }

        .student-card {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .student-card:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }

        .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .student-name {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--primary-color);
        }

        .student-id {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .student-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.85em;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .detail-value {
            font-size: 1em;
            color: var(--dark-text);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-admitted {
            background: #dcfce7;
            color: #166534;
        }

        .status-draft {
            background: #fef3c7;
            color: #92400e;
        }

        .status-submitted {
            background: #dbeafe;
            color: #1e40af;
        }

        .fee-breakdown {
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }

        .fee-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .fee-table th,
        .fee-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .fee-table th {
            background: #f8fafc;
            font-weight: 600;
            color: var(--dark-text);
        }

        .fee-table tr:hover {
            background: #f8fafc;
        }

        .total-row {
            font-weight: 700;
            font-size: 1.1em;
            color: var(--primary-color);
            background: #f1f5f9 !important;
        }

        .installment-section {
            margin-top: 25px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .installment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .installment-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
        }

        .installment-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .installment-amount {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--accent-color);
        }

        .installment-date {
            font-size: 0.9em;
            color: #64748b;
            margin-top: 5px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border-left: 4px solid var(--success-color);
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger-color);
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid var(--secondary-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #64748b;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .fee-breakdown, .fee-breakdown * {
                visibility: visible;
            }
            .fee-breakdown {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .btn {
                display: none !important;
            }
        }

        @media (max-width: 1024px) {
            .sidebar {
                position: relative;
                left: 0;
                width: 100%;
                margin-bottom: 20px;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-section">
                <div class="logo">S</div>
                <div>
                    <h1>Shakti Junior College</h1>
                    <p class="tagline">Empowering Dreams, Shaping Futures</p>
                </div>
            </div>
            <span class="academic-year">Academic Year 2026-2027</span>
        </header>

        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Navigation</h3>
                <p class="user-info">Welcome, Admin</p>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" onclick="showSection('dashboard')">üìä Dashboard</li>
                <li class="nav-item" onclick="showSection('walkin')">üö∂ Walk In</li>
                <li class="nav-item" onclick="showSection('admission')">üìù Admission Form</li>
                <li class="nav-item" onclick="showSection('students')">üë• Students</li>
                <li class="nav-item" onclick="showSection('billing')">üí≥ Billing</li>
                <li class="nav-item" onclick="showSection('collections')">üí∞ Collections</li>
                <li class="nav-item" onclick="showSection('export')">üì• Export Data</li>
            </ul>
        </div>

        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section active">
                <div class="section-header">
                    <h2 class="section-title">Dashboard Overview</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalWalkins">0</div>
                        <div class="stat-label">Walk-ins</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalDraft">0</div>
                        <div class="stat-label">Draft Applications</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalAdmissions">0</div>
                        <div class="stat-label">Admissions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalEnrolled">0</div>
                        <div class="stat-label">Enrolled</div>
                    </div>
                </div>

                <div id="dashboardStats"></div>
            </div>

            <!-- Walk In Section -->
            <div id="walkin" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Walk In Registration</h2>
                </div>
                <div id="walkinAlert"></div>

                <form id="walkinForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="required">Student Name</label>
                            <input type="text" id="walkStudent Name" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Mobile Number</label>
                            <input type="tel" id="walkinMobile" pattern="[0-9]{10}" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Email</label>
                            <input type="email" id="walkinEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Grade</label>
                            <select id="walkinGrade" required>
                                <option value="">Select Grade</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="required">City</label>
                        <input type="text" id="walkinCity" required>
                    </div>

                    <button type="submit" class="btn btn-primary">Register Walk-in</button>
                </form>
            </div>

            <!-- Admission Form Section -->
            <div id="admission" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Student Admission Application</h2>
                </div>
                <div id="admissionAlert"></div>

                <form id="admissionForm">
                    <h3 style="color: var(--primary-color); margin-bottom: 20px;">Student Details</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="required">Student Name</label>
                            <input type="text" id="studentName" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Student Email</label>
                            <input type="email" id="studentEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Mobile Number</label>
                            <input type="tel" id="studentMobile" pattern="[0-9]{10}" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Grade</label>
                            <select id="grade" required>
                                <option value="">Select Grade</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required">City</label>
                            <input type="text" id="city" required>
                        </div>
                        <div class="form-group">
                            <label class="required">Centre Name</label>
                            <select id="centreName" required>
                                <option value="">Select Centre</option>
                                <option value="Adilabad">Adilabad</option>
                                <option value="Hyderabad">Hyderabad</option>
                                <option value="Warangal">Warangal</option>
                            </select>
                        </div>
                    </div>

                    <h3 style="color: var(--primary-color); margin: 30px 0 20px;">Course Details</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="required">Course</label>
                            <select id="course" required onchange="calculateFees()">
                                <option value="">Select Course</option>
                                <option value="MEC" data-tuition="60000" data-hostel="80000">MEC</option>
                                <option value="CEC" data-tuition="60000" data-hostel="80000">CEC</option>
                                <option value="MPC-EAPCET" data-tuition="70000" data-hostel="80000">MPC + EAPCET</option>
                                <option value="BiPC-EAPCET" data-tuition="70000" data-hostel="80000">BiPC + EAPCET</option>
                                <option value="MPC-TechBee" data-tuition="100000" data-hostel="80000">MPC + TechBee</option>
                                <option value="BiPC-PharmaBee" data-tuition="100000" data-hostel="80000">BiPC + PharmaBee</option>
                                <option value="MPC-Defence" data-tuition="120000" data-hostel="0">MPC + Defence</option>
                                <option value="BiPC-Defence" data-tuition="120000" data-hostel="0">BiPC + Defence</option>
                                <option value="CEC-Defence" data-tuition="120000" data-hostel="0">CEC + Defence</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required">Target</label>
                            <select id="target" required>
                                <option value="">Select Target</option>
                                <option value="JEE_Main">JEE Main</option>
                                <option value="EAPCET">EAPCET</option>
                                <option value="NEET">NEET</option>
                                <option value="Defence">Defence</option>
                                <option value="Commerce">Commerce</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required">Duration</label>
                            <select id="duration" required>
                                <option value="">Select Duration</option>
                                <option value="TWO_YEARS">Two Years</option>
                                <option value="ONE_YEAR">One Year</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required">Batch Type</label>
                            <select id="batchType" required>
                                <option value="">Select Batch Type</option>
                                <option value="WEEKDAY">Weekday</option>
                                <option value="WEEKEND">Weekend</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required">Batch Timings</label>
                            <select id="batchTimings" required>
                                <option value="">Select Timing</option>
                                <option value="MORNING">Morning</option>
                                <option value="AFTERNOON">Afternoon</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required">Hostel Required</label>
                            <select id="hostelRequired" onchange="calculateFees()" required>
                                <option value="No">No</option>
                                <option value="Yes">Yes</option>
                            </select>
                        </div>
                    </div>

                    <div id="feeBreakdownPreview"></div>

                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </form>
            </div>

            <!-- Students Section -->
            <div id="students" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">All Students</h2>
                </div>
                
                <div class="search-box">
                    <input type="text" id="searchStudents" placeholder="Search by name, mobile, or student ID...">
                </div>

                <div id="studentsList"></div>
            </div>

            <!-- Billing Section -->
            <div id="billing" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Fee Billing & Payment</h2>
                </div>
                <div id="billingAlert"></div>
                
                <div class="search-box">
                    <input type="text" id="searchBilling" placeholder="Search student for billing...">
                </div>

                <div id="billingList"></div>
            </div>

            <!-- Collections Section -->
            <div id="collections" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Fee Collections Summary</h2>
                </div>
                
                <div id="collectionsStats"></div>
                <div id="collectionsList"></div>
            </div>

            <!-- Export Section -->
            <div id="export" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Export Data</h2>
                </div>
                
                <p style="margin-bottom: 20px; color: #64748b;">Download all student and billing data as Excel file for backup and analysis.</p>
                
                <button class="btn btn-success" onclick="exportToExcel()">üì• Download Excel Report</button>

                <div style="margin-top: 30px; padding: 25px; background: #f8fafc; border-radius: 12px;">
                    <h3 style="color: var(--primary-color); margin-bottom: 20px;">System Statistics</h3>
                    <div id="exportStats"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fee Details Modal -->
    <div id="feeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: var(--primary-color);">Fee Details & Payment</h2>
                <button class="close-btn" onclick="closeFeeModal()">&times;</button>
            </div>
            <div id="feeModalContent"></div>
        </div>
    </div>

    <script>
        let students = JSON.parse(localStorage.getItem('shaktiStudents')) || [];
        let walkins = JSON.parse(localStorage.getItem('shaktiWalkins')) || [];
        let studentIdCounter = parseInt(localStorage.getItem('shaktiStudentId')) || 88322;

        const FEE_STRUCTURE = {
            'MEC': { tuition: 60000, hostel: 80000 },
            'CEC': { tuition: 60000, hostel: 80000 },
            'MPC-EAPCET': { tuition: 70000, hostel: 80000 },
            'BiPC-EAPCET': { tuition: 70000, hostel: 80000 },
            'MPC-TechBee': { tuition: 100000, hostel: 80000 },
            'BiPC-PharmaBee': { tuition: 100000, hostel: 80000 },
            'MPC-Defence': { tuition: 120000, hostel: 0 },
            'BiPC-Defence': { tuition: 120000, hostel: 0 },
            'CEC-Defence': { tuition: 120000, hostel: 0 }
        };

        const ADMISSION_FEE = 10000;
        const BOOKS_UNIFORM_FEE = 15000;
        const DEFENCE_BOOKS_FEE = 10000;

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            if (sectionId === 'dashboard') updateDashboard();
            if (sectionId === 'students') displayStudents();
            if (sectionId === 'billing') displayBilling();
            if (sectionId === 'collections') displayCollections();
            if (sectionId === 'export') displayExportStats();
        }

        function calculateFees() {
            const courseSelect = document.getElementById('course');
            const hostelRequired = document.getElementById('hostelRequired');
            
            if (!courseSelect.value) return;

            const course = courseSelect.value;
            const fees = FEE_STRUCTURE[course];
            const hostel = hostelRequired.value === 'Yes' ? fees.hostel : 0;
            const isDefence = course.includes('Defence');
            const booksFee = isDefence ? DEFENCE_BOOKS_FEE : BOOKS_UNIFORM_FEE;

            const totalFee = fees.tuition + hostel + ADMISSION_FEE + booksFee;
            
            // Calculate instalments
            const downPayment = Math.round(totalFee * 0.50);
            const secondInstalment = Math.round(totalFee * 0.25);
            const thirdInstalment = totalFee - downPayment - secondInstalment;

            const html = `
                <div class="fee-breakdown">
                    <h3 style="color: var(--primary-color); margin-bottom: 20px;">Fee Breakdown</h3>
                    <table class="fee-table">
                        <thead>
                            <tr>
                                <th>Fee Component</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Tuition Fee</td>
                                <td>‚Çπ${fees.tuition.toLocaleString('en-IN')}</td>
                            </tr>
                            ${hostel > 0 ? `<tr><td>Hostel Fee</td><td>‚Çπ${hostel.toLocaleString('en-IN')}</td></tr>` : ''}
                            <tr>
                                <td>Admission Fee (Non-Refundable)</td>
                                <td>‚Çπ${ADMISSION_FEE.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr>
                                <td>Books/Uniform/Internal Exams/ID Card</td>
                                <td>‚Çπ${booksFee.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr class="total-row">
                                <td>TOTAL ANNUAL FEE</td>
                                <td>‚Çπ${totalFee.toLocaleString('en-IN')}</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="installment-section">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">Payment Instalments</h4>
                        <div class="installment-grid">
                            <div class="installment-card">
                                <div class="installment-title">Down Payment (Joining Day)</div>
                                <div class="installment-amount">‚Çπ${downPayment.toLocaleString('en-IN')}</div>
                                <div class="installment-date">50% - On Admission</div>
                            </div>
                            <div class="installment-card">
                                <div class="installment-title">II Instalment</div>
                                <div class="installment-amount">‚Çπ${secondInstalment.toLocaleString('en-IN')}</div>
                                <div class="installment-date">25% - October 1st, 2026</div>
                            </div>
                            <div class="installment-card">
                                <div class="installment-title">III Instalment</div>
                                <div class="installment-amount">‚Çπ${thirdInstalment.toLocaleString('en-IN')}</div>
                                <div class="installment-date">25% - December 1st, 2026</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('feeBreakdownPreview').innerHTML = html;
        }

        // Walk-in Form
        document.getElementById('walkinForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const walkin = {
                id: 'WI' + Date.now(),
                studentName: document.getElementById('walkinStudentName').value,
                mobile: document.getElementById('walkinMobile').value,
                email: document.getElementById('walkinEmail').value,
                grade: document.getElementById('walkinGrade').value,
                city: document.getElementById('walkinCity').value,
                status: 'Walk-in',
                date: new Date().toLocaleDateString('en-IN'),
                timestamp: new Date().toISOString()
            };

            walkins.push(walkin);
            localStorage.setItem('shaktiWalkins', JSON.stringify(walkins));

            showAlert('walkinAlert', `Walk-in registered successfully! ID: ${walkin.id}`, 'success');
            document.getElementById('walkinForm').reset();
            updateDashboard();
        });

        // Admission Form
        document.getElementById('admissionForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const course = document.getElementById('course').value;
            const fees = FEE_STRUCTURE[course];
            const hostel = document.getElementById('hostelRequired').value === 'Yes' ? fees.hostel : 0;
            const isDefence = course.includes('Defence');
            const booksFee = isDefence ? DEFENCE_BOOKS_FEE : BOOKS_UNIFORM_FEE;
            const totalFee = fees.tuition + hostel + ADMISSION_FEE + booksFee;

            const student = {
                id: studentIdCounter++,
                formNumber: 'SJC' + studentIdCounter,
                name: document.getElementById('studentName').value,
                email: document.getElementById('studentEmail').value,
                mobile: document.getElementById('studentMobile').value,
                grade: document.getElementById('grade').value,
                city: document.getElementById('city').value,
                centre: document.getElementById('centreName').value,
                course: course,
                target: document.getElementById('target').value,
                duration: document.getElementById('duration').value,
                batchType: document.getElementById('batchType').value,
                batchTimings: document.getElementById('batchTimings').value,
                hostelRequired: document.getElementById('hostelRequired').value,
                tuitionFee: fees.tuition,
                hostelFee: hostel,
                admissionFee: ADMISSION_FEE,
                booksFee: booksFee,
                totalFee: totalFee,
                paidAmount: 0,
                balanceDue: totalFee,
                status: 'Form Submitted',
                admissionDate: new Date().toLocaleDateString('en-IN'),
                payments: []
            };

            students.push(student);
            localStorage.setItem('shaktiStudents', JSON.stringify(students));
            localStorage.setItem('shaktiStudentId', studentIdCounter);

            showAlert('admissionAlert', `Application submitted successfully! Form Number: ${student.formNumber}`, 'success');
            document.getElementById('admissionForm').reset();
            document.getElementById('feeBreakdownPreview').innerHTML = '';
            updateDashboard();
        });

        function displayStudents() {
            const searchTerm = document.getElementById('searchStudents').value.toLowerCase();
            const filteredStudents = students.filter(s => 
                s.name.toLowerCase().includes(searchTerm) || 
                s.mobile.includes(searchTerm) ||
                s.formNumber.toLowerCase().includes(searchTerm)
            );

            const html = filteredStudents.map(student => `
                <div class="student-card" onclick="showFeeDetails('${student.formNumber}')">
                    <div class="student-header">
                        <div>
                            <div class="student-name">${student.name}</div>
                            <div style="margin-top: 5px;">
                                <span class="status-badge status-submitted">${student.status}</span>
                            </div>
                        </div>
                        <div class="student-id">Form: ${student.formNumber}</div>
                    </div>
                    <div class="student-details">
                        <div class="detail-item">
                            <span class="detail-label">Mobile</span>
                            <span class="detail-value">${student.mobile}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Course</span>
                            <span class="detail-value">${student.course}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Centre</span>
                            <span class="detail-value">${student.centre}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Total Fee</span>
                            <span class="detail-value">‚Çπ${student.totalFee.toLocaleString('en-IN')}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Paid</span>
                            <span class="detail-value" style="color: var(--success-color);">‚Çπ${student.paidAmount.toLocaleString('en-IN')}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Balance</span>
                            <span class="detail-value" style="color: var(--danger-color);">‚Çπ${student.balanceDue.toLocaleString('en-IN')}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('studentsList').innerHTML = html || '<p style="text-align: center; color: #64748b;">No students found</p>';
        }

        function displayBilling() {
            displayStudents();
            const list = document.getElementById('studentsList');
            document.getElementById('billingList').innerHTML = list.innerHTML;
        }

        function showFeeDetails(formNumber) {
            const student = students.find(s => s.formNumber === formNumber);
            if (!student) return;

            const downPayment = Math.round(student.totalFee * 0.50);
            const secondInstalment = Math.round(student.totalFee * 0.25);
            const thirdInstalment = student.totalFee - downPayment - secondInstalment;

            const html = `
                <div class="fee-breakdown">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <h2 style="color: var(--primary-color); margin-bottom: 10px;">Shakti Junior College</h2>
                        <p style="color: #64748b;">Fee Receipt - Academic Year 2026-2027</p>
                        <p style="margin-top: 10px; font-weight: 600;">Form Number: ${student.formNumber}</p>
                    </div>

                    <div class="student-details" style="margin-bottom: 25px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <div class="detail-item">
                            <span class="detail-label">Student Name</span>
                            <span class="detail-value">${student.name}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Course</span>
                            <span class="detail-value">${student.course}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Centre</span>
                            <span class="detail-value">${student.centre}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Admission Date</span>
                            <span class="detail-value">${student.admissionDate}</span>
                        </div>
                    </div>

                    <table class="fee-table">
                        <thead>
                            <tr>
                                <th>Fee Component</th>
                                <th style="text-align: right;">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Tuition Fee</td>
                                <td style="text-align: right;">‚Çπ${student.tuitionFee.toLocaleString('en-IN')}</td>
                            </tr>
                            ${student.hostelFee > 0 ? `
                            <tr>
                                <td>Hostel Fee</td>
                                <td style="text-align: right;">‚Çπ${student.hostelFee.toLocaleString('en-IN')}</td>
                            </tr>` : ''}
                            <tr>
                                <td>Admission Fee (Non-Refundable)</td>
                                <td style="text-align: right;">‚Çπ${student.admissionFee.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr>
                                <td>Books/Uniform/Internal Exams/ID Card</td>
                                <td style="text-align: right;">‚Çπ${student.booksFee.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr class="total-row">
                                <td>TOTAL FEE</td>
                                <td style="text-align: right;">‚Çπ${student.totalFee.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr style="background: #dcfce7;">
                                <td style="font-weight: 600; color: var(--success-color);">PAID AMOUNT</td>
                                <td style="text-align: right; font-weight: 600; color: var(--success-color);">‚Çπ${student.paidAmount.toLocaleString('en-IN')}</td>
                            </tr>
                            <tr style="background: #fee2e2;">
                                <td style="font-weight: 600; color: var(--danger-color);">BALANCE DUE</td>
                                <td style="text-align: right; font-weight: 600; color: var(--danger-color);">‚Çπ${student.balanceDue.toLocaleString('en-IN')}</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="installment-section">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">Payment Schedule</h4>
                        <div class="installment-grid">
                            <div class="installment-card">
                                <div class="installment-title">Down Payment</div>
                                <div class="installment-amount">‚Çπ${downPayment.toLocaleString('en-IN')}</div>
                                <div class="installment-date">50% - On Joining Day</div>
                            </div>
                            <div class="installment-card">
                                <div class="installment-title">II Instalment</div>
                                <div class="installment-amount">‚Çπ${secondInstalment.toLocaleString('en-IN')}</div>
                                <div class="installment-date">25% - October 1st, 2026</div>
                            </div>
                            <div class="installment-card">
                                <div class="installment-title">III Instalment</div>
                                <div class="installment-amount">‚Çπ${thirdInstalment.toLocaleString('en-IN')}</div>
                                <div class="installment-date">25% - December 1st, 2026</div>
                            </div>
                        </div>
                    </div>

                    ${student.balanceDue > 0 ? `
                    <div style="margin-top: 25px; padding: 20px; background: #f8fafc; border-radius: 10px;">
                        <h4 style="color: var(--primary-color); margin-bottom: 15px;">Record Payment</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Payment Amount</label>
                                <input type="number" id="paymentAmount" max="${student.balanceDue}" min="0" style="width: 100%;">
                            </div>
                            <div class="form-group">
                                <label>Payment Type</label>
                                <select id="paymentType" style="width: 100%;">
                                    <option value="Down Payment">Down Payment</option>
                                    <option value="EMI 1">EMI 1</option>
                                    <option value="EMI 2">EMI 2</option>
                                    <option value="EMI 3">EMI 3</option>
                                    <option value="Full Payment">Full Payment</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="recordPayment('${student.formNumber}')">üí≥ Record Payment</button>
                    </div>
                    ` : ''}

                    <div style="margin-top: 25px; display: flex; gap: 10px;">
                        <button class="btn btn-outline" onclick="window.print()">üñ®Ô∏è Print Receipt</button>
                        <button class="btn btn-outline" onclick="closeFeeModal()">Close</button>
                    </div>
                </div>
            `;

            document.getElementById('feeModalContent').innerHTML = html;
            document.getElementById('feeModal').classList.add('active');
        }

        function recordPayment(formNumber) {
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const type = document.getElementById('paymentType').value;

            if (!amount || amount <= 0) {
                alert('Please enter a valid payment amount');
                return;
            }

            const student = students.find(s => s.formNumber === formNumber);
            if (amount > student.balanceDue) {
                alert('Payment amount exceeds balance due');
                return;
            }

            student.paidAmount += amount;
            student.balanceDue -= amount;
            student.payments.push({
                amount: amount,
                type: type,
                date: new Date().toLocaleDateString('en-IN'),
                timestamp: new Date().toISOString()
            });

            if (student.balanceDue === 0) {
                student.status = 'Fully Paid';
            } else {
                student.status = 'Partial Payment';
            }

            localStorage.setItem('shaktiStudents', JSON.stringify(students));
            showAlert('billingAlert', `Payment of ‚Çπ${amount.toLocaleString('en-IN')} recorded successfully!`, 'success');
            closeFeeModal();
            displayBilling();
            updateDashboard();
        }

        function closeFeeModal() {
            document.getElementById('feeModal').classList.remove('active');
        }

        function displayCollections() {
            const totalCollected = students.reduce((sum, s) => sum + s.paidAmount, 0);
            const totalExpected = students.reduce((sum, s) => sum + s.totalFee, 0);
            const totalPending = totalExpected - totalCollected;
            const fullyPaid = students.filter(s => s.balanceDue === 0).length;

            const statsHtml = `
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--success-color);">‚Çπ${(totalCollected / 100000).toFixed(2)}L</div>
                        <div class="stat-label">Total Collected</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--primary-color);">‚Çπ${(totalExpected / 100000).toFixed(2)}L</div>
                        <div class="stat-label">Total Expected</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--danger-color);">‚Çπ${(totalPending / 100000).toFixed(2)}L</div>
                        <div class="stat-label">Total Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--success-color);">${fullyPaid}</div>
                        <div class="stat-label">Fully Paid Students</div>
                    </div>
                </div>
            `;

            const listHtml = students.map(student => `
                <div class="student-card">
                    <div class="student-header">
                        <div class="student-name">${student.name}</div>
                        <div class="student-id">${student.formNumber}</div>
                    </div>
                    <div class="student-details">
                        <div class="detail-item">
                            <span class="detail-label">Course</span>
                            <span class="detail-value">${student.course}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Total Fee</span>
                            <span class="detail-value">‚Çπ${student.totalFee.toLocaleString('en-IN')}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Collected</span>
                            <span class="detail-value" style="color: var(--success-color);">‚Çπ${student.paidAmount.toLocaleString('en-IN')}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Pending</span>
                            <span class="detail-value" style="color: var(--danger-color);">‚Çπ${student.balanceDue.toLocaleString('en-IN')}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Payments Made</span>
                            <span class="detail-value">${student.payments.length}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('collectionsStats').innerHTML = statsHtml;
            document.getElementById('collectionsList').innerHTML = listHtml;
        }

        function updateDashboard() {
            document.getElementById('totalWalkins').textContent = walkins.length;
            document.getElementById('totalDraft').textContent = students.filter(s => s.status === 'Draft').length;
            document.getElementById('totalAdmissions').textContent = students.filter(s => s.status === 'Form Submitted').length;
            document.getElementById('totalEnrolled').textContent = students.filter(s => s.paidAmount > 0).length;

            const totalCollected = students.reduce((sum, s) => sum + s.paidAmount, 0);
            const totalExpected = students.reduce((sum, s) => sum + s.totalFee, 0);

            const statsHtml = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--success-color);">‚Çπ${(totalCollected / 100000).toFixed(2)}L</div>
                        <div class="stat-label">Total Revenue Collected</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: var(--primary-color);">‚Çπ${(totalExpected / 100000).toFixed(2)}L</div>
                        <div class="stat-label">Expected Revenue</div>
                    </div>
                </div>
            `;

            document.getElementById('dashboardStats').innerHTML = statsHtml;
        }

        function displayExportStats() {
            const totalCollected = students.reduce((sum, s) => sum + s.paidAmount, 0);
            const totalExpected = students.reduce((sum, s) => sum + s.totalFee, 0);

            const html = `
                <div class="student-details">
                    <div class="detail-item">
                        <span class="detail-label">Total Walk-ins</span>
                        <span class="detail-value" style="font-size: 1.5em; color: var(--primary-color);">${walkins.length}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Total Admissions</span>
                        <span class="detail-value" style="font-size: 1.5em; color: var(--primary-color);">${students.length}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Total Collected</span>
                        <span class="detail-value" style="font-size: 1.5em; color: var(--success-color);">‚Çπ${(totalCollected / 100000).toFixed(2)}L</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Expected Revenue</span>
                        <span class="detail-value" style="font-size: 1.5em; color: var(--primary-color);">‚Çπ${(totalExpected / 100000).toFixed(2)}L</span>
                    </div>
                </div>
            `;

            document.getElementById('exportStats').innerHTML = html;
        }

        function exportToExcel() {
            if (students.length === 0) {
                alert('No student data to export!');
                return;
            }

            const exportData = students.map(s => ({
                'Form Number': s.formNumber,
                'Student Name': s.name,
                'Email': s.email,
                'Mobile': s.mobile,
                'Grade': s.grade,
                'City': s.city,
                'Centre': s.centre,
                'Course': s.course,
                'Target': s.target,
                'Duration': s.duration,
                'Batch Type': s.batchType,
                'Batch Timings': s.batchTimings,
                'Hostel Required': s.hostelRequired,
                'Tuition Fee': s.tuitionFee,
                'Hostel Fee': s.hostelFee,
                'Admission Fee': s.admissionFee,
                'Books/Uniform Fee': s.booksFee,
                'Total Fee': s.totalFee,
                'Paid Amount': s.paidAmount,
                'Balance Due': s.balanceDue,
                'Status': s.status,
                'Admission Date': s.admissionDate,
                'Number of Payments': s.payments.length
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Students");

            // Add walkins sheet
            if (walkins.length > 0) {
                const walkinData = walkins.map(w => ({
                    'ID': w.id,
                    'Student Name': w.studentName,
                    'Mobile': w.mobile,
                    'Email': w.email,
                    'Grade': w.grade,
                    'City': w.city,
                    'Date': w.date
                }));
                const wsWalkin = XLSX.utils.json_to_sheet(walkinData);
                XLSX.utils.book_append_sheet(wb, wsWalkin, "Walk-ins");
            }

            const fileName = `Shakti_Junior_College_${new Date().toLocaleDateString('en-IN').replace(/\//g, '-')}.xlsx`;
            XLSX.writeFile(wb, fileName);
        }

        function showAlert(elementId, message, type) {
            const alertDiv = document.getElementById(elementId);
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => alertDiv.innerHTML = '', 5000);
        }

        // Search functionality
        document.getElementById('searchStudents').addEventListener('input', displayStudents);
        document.getElementById('searchBilling').addEventListener('input', displayBilling);

        // Initialize
        updateDashboard();
    </script>
</body>
</html>
